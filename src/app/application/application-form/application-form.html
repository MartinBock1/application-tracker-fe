<div class="auth-container">
  <div class="auth-card">
    <h2>
      {{ isEditMode ? "Bewerbung bearbeiten" : "Neue Bewerbung erstellen" }}
    </h2>

    <p class="subtitle" *ngIf="!isEditMode">
      Fülle die Details deiner Bewerbung aus.
    </p>

    <form [formGroup]="applicationForm" (ngSubmit)="onSubmit()">
      <fieldset>
        <legend>Bewerbungsdetails</legend>
        
        <!-- Jobtitel, Firma, Status (bleiben unverändert) -->
        <div class="form-group">
          <label for="job_title">
            Jobtitel <span class="required-asterisk">*</span>
          </label>
          <input id="job_title" type="text" formControlName="job_title" placeholder="z.B. Senior Frontend Developer" />
        </div>
        <div class="form-group">
          <label for="company_id">
            Unternehmen <span class="required-asterisk">*</span>
          </label>
          <select id="company_id" formControlName="company_id">
            <option [ngValue]="null" disabled>Bitte Unternehmen auswählen</option>
            <option *ngFor="let company of companies" [ngValue]="company.id">{{ company.name }}</option>
          </select>
        </div>
        <div class="form-group">
          <label for="status">
            Status ( bitte auswählen )
          </label>
          <select id="status" formControlName="status">
            <option value="DRAFT">Entwurf</option>
            <option value="APPLIED">Beworben</option>
            <option value="INTERVIEW">Interview</option>
            <option value="OFFER">Angebot erhalten</option>
            <option value="REJECTED">Abgelehnt</option>
            <option value="WITHDRAWN">Zurückgezogen</option>
          </select>
        </div>

        <!-- ======================================================== -->
        <!-- HIER BEGINNT DER NEUE, DYNAMISCHE DATUMS-BLOCK           -->
        <!-- ======================================================== -->

        <!-- Zeige "Beworben am", wenn der Status APPLIED ist -->
        <div class="form-group" *ngIf="applicationForm.get('status')?.value === 'APPLIED'">
          <label for="applied_on">
            Beworben am <span class="required-asterisk">*</span>
          </label>
          <input id="applied_on" type="date" formControlName="applied_on" />
        </div>

        <!-- Zeige "Interview am", wenn der Status INTERVIEW ist -->
        <div class="form-group" *ngIf="applicationForm.get('status')?.value === 'INTERVIEW'">
          <label for="interview_on">
            Interview am <span class="required-asterisk">*</span>
          </label>
          <input id="interview_on" type="date" formControlName="interview_on" />
        </div>

        <!-- Zeige "Angebot erhalten am", wenn der Status OFFER ist -->
        <div class="form-group" *ngIf="applicationForm.get('status')?.value === 'OFFER'">
          <label for="offer_on">
            Angebot erhalten am <span class="required-asterisk">*</span>
          </label>
          <input id="offer_on" type="date" formControlName="offer_on" />
        </div>

        <!-- Zeige "Abgelehnt am", wenn der Status REJECTED ist -->
        <div class="form-group" *ngIf="applicationForm.get('status')?.value === 'REJECTED'">
          <label for="rejected_on">
            Abgelehnt am <span class="required-asterisk">*</span>
          </label>
          <input id="rejected_on" type="date" formControlName="rejected_on" />
        </div>
        
        <!-- Optional: Ein Feld für das Nachhaken, das immer angezeigt werden kann -->
        <div class="form-group">
          <label for="follow_up_on">Nachhaken am</label>
          <input id="follow_up_on" type="date" formControlName="follow_up_on" />
        </div>

      </fieldset>

      <!-- Notiz-Sektion (bleibt unverändert, ist bereits korrekt) -->
      <fieldset *ngIf="isEditMode" class="notes-fieldset">
        <legend>Notizen</legend>
        <div formArrayName="notes" class="notes-container">
          <p *ngIf="notes.length === 0" class="no-notes-info">Noch keine Notizen hinzugefügt.</p>
          <div *ngFor="let note of notes.controls; let i = index" [formGroupName]="i" class="note-item">
            <textarea formControlName="text" placeholder="Ihre Notiz..."></textarea>
            <button type="button" (click)="onDeleteNote(i)" class="btn-remove-note" title="Notiz entfernen">×</button>
          </div>
        </div>
        <button type="button" (click)="onAddNote()" class="btn-add-note">+ Neue Notiz hinzufügen</button>
      </fieldset>

      <br />
      <button type="submit" class="btn btn-primary" [disabled]="applicationForm.invalid">
        {{ isEditMode ? "Änderungen speichern" : "Bewerbung erstellen" }}
      </button>
    </form>

    <div class="switch-auth-link">
      <a routerLink="/applications">Zurück zur Übersicht</a>
    </div>
  </div>
</div>
