<div class="list-container">
  <header class="list-header">
    <div class="list-title-wrapper">
      <h2>Meine Bewerbungen</h2>
      <!-- Show follow-up indicator if there are due follow-ups -->
      @if(dueFollowUpsCount > 0) {
      <span class="follow-up-indicator">
        {{ dueFollowUpsCount }} Wiedervorlage fällig!
      </span>
      }
    </div>
  </header>

  <!-- Display loading spinner while fetching data -->
  @if(isLoading) {
  <div class="loading-indicator">
    <div class="spinner"></div>
    <p>Lade Bewerbungen...</p>
  </div>
  }

  <!-- Display error message if an error occurs -->
  @if(errorMessage) {
  <div class="error-message">
    {{ errorMessage }}
  </div>
  } 
  
  <!-- Main content area - only show when not loading and no error -->
  @if(!isLoading && !errorMessage) {

  <!-- Case 1: No applications -> Show empty state message -->
  @if (allApplications.length === 0) {
    <div class="empty-state">
      <h3>Noch keine Bewerbungen erfasst.</h3>
      <p>Klicke auf "Neue Bewerbung", um deine erste Bewerbung hinzuzufügen.</p>
    </div>
  } @else {
    <!-- Case 2: Applications exist -> Show Kanban board -->
    <div class="kanban-board-container">
      <div class="kanban-board">
        <!-- Iterate over 'statusOrder' list to create columns -->
        @for (status of statusOrder; track status) {
          <div class="kanban-column">
            <!-- Column header with status title and application count -->
            <header class="kanban-column-header">
              <h3>{{ statusTitleMap[status] }}</h3>
              <span class="card-count">{{ groupedApplications[status].length }}</span>
            </header>
            <div class="kanban-cards-container">
              <!-- Show empty message if no applications in this status -->
              @if (groupedApplications[status].length === 0) {
                <p class="empty-column-text">Keine Bewerbungen</p>
              }

              <!-- Loop through applications. 'track app.id' is important for performance. -->
              @for (app of groupedApplications[status]; track app.id) {
                <!-- Application card with conditional follow-up styling -->
                <div class="application-card" [class.follow-up-due]="isFollowUpDue(app.follow_up_on)">
                  <!-- START OF REUSABLE CARD CONTENT -->
                  <h3>{{ app.job_title }}</h3>
                  <p class="company-name">{{ app.company.name }}</p>

                  <!-- Status and date information -->
                  <div class="details">
                    <span class="status-badge" [ngClass]="'status-' + app.status">
                      {{ app.status_display }}
                    </span>
                                        
                    <!-- Display relevant date based on current status -->
                    <span class="status-date">
                      @switch (app.status) {
                        @case ('APPLIED') { <span>{{ app.applied_on | date : "dd.MM.yy" }}</span> }
                        @case ('INTERVIEW') { <span>{{ app.interview_on | date : "dd.MM.yy" }}</span> }
                        @case ('OFFER') { <span>{{ app.offer_on | date : "dd.MM.yy" }}</span> }
                        @case ('REJECTED') { <span>{{ app.rejected_on | date : "dd.MM.yy" }}</span> }
                        @default { <span>{{ app.created_at | date : "dd.MM.yy" }}</span> }
                      }
                    </span>
                  </div>
                  
                  <!-- Show follow-up date if set -->
                  @if (app.follow_up_on) {
                    <div class="details follow-up">
                      <span>Nachhaken: {{ app.follow_up_on | date : "dd.MM.yyyy" }}</span>
                    </div>
                  }
                  
                  <!-- Notes are intentionally omitted here to keep the card compact -->
                  <a class="details-link" [routerLink]="['/applications/edit', app.id]">Details / Bearbeiten</a>
                  <!-- END OF CARD CONTENT -->
                </div>
              }
            </div>
          </div>
        }
      </div>
    </div>
  }
}
</div>
