<div class="list-container">
  <header class="list-header">
    <div class="list-title-wrapper">
      <h2>Meine Bewerbungen</h2>
      <span *ngIf="dueFollowUpsCount > 0" class="follow-up-indicator">
        {{ dueFollowUpsCount }} Wiedervorlage fällig!
      </span>
    </div>
  </header>

  <!-- Lade-Spinner anzeigen, während die Daten geholt werden -->
  <div *ngIf="isLoading" class="loading-indicator">
    <div class="spinner"></div>
    <p>Lade Bewerbungen...</p>
  </div>

  <!-- Fehlermeldung anzeigen, falls ein Fehler auftritt -->
  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
  </div>

   <div *ngIf="!isLoading && !errorMessage">
    <!-- Fall 1: Keine Bewerbungen -> Zeige eine "Leer"-Nachricht an -->
    <div *ngIf="allApplications.length === 0; else kanbanBoard" class="empty-state">
      <h3>Noch keine Bewerbungen erfasst.</h3>
      <p>Klicke auf "Neue Bewerbung", um deine erste Bewerbung hinzuzufügen.</p>
    </div>

    <!-- Fall 2: Es gibt Bewerbungen -> Zeige das Kanban-Board an -->
    <ng-template #kanbanBoard>
      <div class="kanban-board-container">
        <div class="kanban-board">
          
          <!-- Wir iterieren über die 'statusOrder'-Liste, um die Spalten zu erstellen -->
          <div *ngFor="let status of statusOrder" class="kanban-column">
            
            <!-- Spalten-Header -->
            <header class="kanban-column-header">
              <h3>{{ statusTitleMap[status] }}</h3>
              <span class="card-count">{{ groupedApplications[status].length }}</span>
            </header>

            <!-- Spalten-Inhalt mit den Karten -->
            <div class="kanban-cards-container">
              <p *ngIf="groupedApplications[status].length === 0" class="empty-column-text">Keine Bewerbungen</p>

              <!-- Die *ngFor-Schleife für die Karten. Die Karte selbst ist unverändert! -->
              <div *ngFor="let app of groupedApplications[status]" 
                   class="application-card" 
                   [class.follow-up-due]="isFollowUpDue(app.follow_up_on)">
                
                <!-- HIER BEGINNT DER RECYCELTE KARTEN-CODE -->
                <h3>{{ app.job_title }}</h3>
                <p class="company-name">{{ app.company.name }}</p>
                <div class="details">
                  <span class="status-badge" [ngClass]="'status-' + app.status">
                    {{ app.status_display }}
                  </span>
                  <span class="status-date" [ngSwitch]="app.status">
                    <span *ngSwitchCase="'APPLIED'">{{ app.applied_on | date:'dd.MM.yy' }}</span>
                    <span *ngSwitchCase="'INTERVIEW'">{{ app.interview_on | date:'dd.MM.yy' }}</span>
                    <span *ngSwitchCase="'OFFER'">{{ app.offer_on | date:'dd.MM.yy' }}</span>
                    <span *ngSwitchCase="'REJECTED'">{{ app.rejected_on | date:'dd.MM.yy' }}</span>
                    <span *ngSwitchDefault>{{ app.created_at | date:'dd.MM.yy' }}</span>
                  </span>
                </div>
                <div class="details follow-up" *ngIf="app.follow_up_on">
                    <span>Nachhaken: {{ app.follow_up_on | date:'dd.MM.yyyy' }}</span>
                </div>
                <!-- Notizen werden hier bewusst weggelassen, um die Karte kompakt zu halten -->
                <a class="details-link" [routerLink]="['/applications/edit', app.id]">Details / Bearbeiten</a>
                <!-- ENDE KARTEN-CODE -->

              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-template>
  </div>
</div>
